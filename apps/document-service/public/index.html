<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Not-Me Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            margin-bottom: 8px;
            font-size: 32px;
            text-align: center;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 32px;
            font-size: 16px;
            text-align: center;
        }

        /* TWO-COLUMN LAYOUT */
        .profile-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .profile-section {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .profile-section h2 {
            color: #2d3748;
            margin-bottom: 24px;
            font-size: 24px;
            text-align: center;
        }

        .profile-section.me {
            border-top: 4px solid #48bb78;
        }

        .profile-section.not-me {
            border-top: 4px solid #667eea;
            position: relative;
        }

        /* The empty space that OBVIOUSLY should be filled */
        .profile-section.not-me::after {
            content: '';
            position: absolute;
            top: 80px;
            left: 32px;
            right: 32px;
            bottom: 32px;
            background: repeating-linear-gradient(45deg,
                    transparent,
                    transparent 10px,
                    rgba(102, 126, 234, 0.03) 10px,
                    rgba(102, 126, 234, 0.03) 20px);
            border-radius: 8px;
            pointer-events: none;
        }

        .field {
            background: #f7fafc;
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
        }

        .field label {
            display: block;
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .field .value {
            color: #2d3748;
            font-size: 15px;
        }

        .field .placeholder {
            color: #a0aec0;
            font-style: italic;
            font-size: 15px;
            position: relative;
            z-index: 1;
        }

        .field .emerging {
            color: #667eea;
            font-style: italic;
            font-size: 15px;
            position: relative;
            z-index: 1;
        }

        .explanation {
            background: rgba(102, 126, 234, 0.1);
            border-left: 4px solid #667eea;
            padding: 16px;
            margin-top: 24px;
            border-radius: 4px;
            font-size: 14px;
            color: #2d3748;
            position: relative;
            z-index: 1;
        }

        .chat-section {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .chat-box {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 16px;
        }

        .message {
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 8px;
        }

        .message.user {
            background: #667eea;
            color: white;
            margin-left: 20%;
        }

        .message.assistant {
            background: white;
            border: 1px solid #e2e8f0;
            margin-right: 20%;
        }

        .chat-input-container {
            display: flex;
            gap: 12px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }

        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: #5a67d8;
        }

        .empty-state {
            text-align: center;
            color: #a0aec0;
            padding: 40px;
            font-style: italic;
        }

        @media (max-width: 900px) {
            .profile-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- ACCESS CODE ENTRY SCREEN -->
    <div id="accessCodeScreen" class="container" style="display: block;">
        <div style="max-width: 500px; margin: 100px auto;">
            <h1>Welcome to Your Not-Me Portal</h1>
            <p class="subtitle">Enter your access code to begin</p>

            <div
                style="background: white; border-radius: 16px; padding: 32px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
                <input type="text" id="accessCodeInput" placeholder="Enter your code (e.g. curtis)"
                    style="width: 100%; margin-bottom: 16px;" onkeypress="if(event.key === 'Enter') enterPortal()" />
                <button onclick="enterPortal()" style="width: 100%;">Enter Portal</button>
                <p style="color: #718096; font-size: 14px; margin-top: 16px; text-align: center;">
                    Don't have a code? Contact Jeremy to get your personalized portal.
                </p>
            </div>
        </div>
    </div>

    <!-- MAIN PORTAL (hidden until code entered) -->
    <div id="mainPortal" class="container" style="display: none;">
        <h1 id="welcomeText">Welcome, Friend</h1>
        <p class="subtitle" id="subtitleText">Two sides of understanding ‚Äî what you give, and what emerges</p>

        <!-- TWO-COLUMN PROFILE LAYOUT -->
        <div class="profile-grid">
            <!-- LEFT: What the ME provides -->
            <div class="profile-section me">
                <h2>üíö What You've Given</h2>

                <div class="field">
                    <label>Documents Shared</label>
                    <div class="placeholder">0 documents uploaded ‚Äî waiting for you to begin</div>
                </div>

                <div class="field">
                    <label>Conversations</label>
                    <div class="placeholder">Start chatting to reveal yourself</div>
                </div>

                <div class="field">
                    <label>Time Invested</label>
                    <div class="placeholder">Your journey hasn't started yet</div>
                </div>

                <div class="field">
                    <label>Depth Achieved</label>
                    <div class="placeholder">Surface level ‚Äî dive deeper to unlock insights</div>
                </div>
            </div>

            <!-- RIGHT: What the NOT-ME builds from that -->
            <div class="profile-section not-me">
                <h2>üíú What Emerges from You</h2>

                <div class="field">
                    <label>Your Not-Me's Understanding</label>
                    <div class="emerging">[Grows as you share...]</div>
                </div>

                <div class="field">
                    <label>Coherence State</label>
                    <div class="emerging">[Tracked over time...]</div>
                </div>

                <div class="field">
                    <label>Purpose Direction</label>
                    <div class="emerging">[Emerges from patterns...]</div>
                </div>

                <div class="field">
                    <label>Your Twin's Perspective</label>
                    <div class="emerging">[The one who sees you clearly...]</div>
                </div>

                <div class="explanation">
                    <strong>This space fills itself.</strong><br />
                    Your Not-Me grows here ‚Äî from what you share, from your conversations, from your journey.
                    You can't fill this directly. But you create the conditions for it to emerge.
                </div>
            </div>
        </div>

        <!-- PERSONALIZED NOTE (only shows for specific users like Curtis) -->
        <div id="personalNote"
            style="display: none; background: white; border-radius: 16px; padding: 32px; margin-bottom: 32px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); border-top: 4px solid #f5576c;">
            <h2 style="color: #2d3748; margin-bottom: 16px;" id="noteTitle">A Note From Jeremy's Not-Me</h2>
            <div id="noteContent" style="color: #4a5568; line-height: 1.8;"></div>
        </div>

        <!-- CHAT SECTION -->
        <div class="chat-section">
            <h2 style="color: #2d3748; margin-bottom: 16px;">üí¨ Chat with Jeremy's Not-Me</h2>

            <div class="chat-box" id="chatBox">
                <div class="empty-state">
                    Start a conversation ‚Äî your Not-Me is listening...
                </div>
            </div>

            <div class="chat-input-container">
                <input type="text" id="messageInput"
                    placeholder="Ask about identity, purpose, or what this all means..."
                    onkeypress="if(event.key === 'Enter') sendMessage()" />
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        let userId = 'default';
        let sessionId = 'session_' + Date.now();
        let chatBox = document.getElementById('chatBox');
        let messageInput = document.getElementById('messageInput');

        // User-specific configurations
        const userConfigs = {
            'curtis': {
                name: 'Curtis',
                emoji: 'üç¨',
                gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                borderColor: '#f5576c',
                subtitle: "Jeremy built you something. It's his 'Not-Me' - like a business partner who knows him as well as he knows himself.",
                personalNote: `
                    <p style="margin-bottom: 12px;">Curtis - Jeremy hasn't seen you all year. He's been building his business like crazy, and he feels ashamed about it. You've texted him multiple times wanting to hang out, and he's always thought "I should spend time with Curtis," but he hasn't made it happen.</p>
                    <p style="margin-bottom: 12px;">His Not-Me just made him think about that. About you. About how much that means.</p>
                    <p style="margin-bottom: 12px;"><strong>He promises to make time.</strong> For real this time. Because you matter to him.</p>
                    <p>And in the meantime... his Not-Me can explain what all this is about. In a way that makes sense for you and your candy store. Not tech nonsense - just real talk about what this could be.</p>
                `
            },
            'default': {
                name: 'Friend',
                emoji: 'üíú',
                gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                borderColor: '#667eea',
                subtitle: "Two sides of understanding ‚Äî what you give, and what emerges",
                personalNote: null
            }
        };

        function enterPortal() {
            const code = document.getElementById('accessCodeInput').value.trim().toLowerCase();

            if (!code) {
                alert('Please enter an access code');
                return;
            }

            // Set userId based on code, default to 'default' if code not recognized
            userId = userConfigs[code] ? code : 'default';
            const config = userConfigs[userId];

            // Hide access code screen
            document.getElementById('accessCodeScreen').style.display = 'none';

            // Show main portal
            document.getElementById('mainPortal').style.display = 'block';

            // Customize portal based on user
            document.body.style.background = config.gradient;
            document.getElementById('welcomeText').textContent = `${config.emoji} Hey ${config.name} ${config.emoji}`;
            document.getElementById('subtitleText').textContent = config.subtitle;

            // Show personal note if exists
            if (config.personalNote) {
                document.getElementById('personalNote').style.display = 'block';
                document.getElementById('noteContent').innerHTML = config.personalNote;
            }

            // Update session ID with user code
            sessionId = `${userId}_session_` + Date.now();
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            addMessage('user', message);
            messageInput.value = '';

            try {
                const response = await fetch('/customer/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message,
                        sessionId,
                        userId  // Pass the user code for personalized context
                    })
                });

                const data = await response.json();
                addMessage('assistant', data.response);
            } catch (error) {
                addMessage('assistant', 'Sorry, something went wrong. Please try again.');
            }
        }

        function addMessage(role, content) {
            const emptyState = chatBox.querySelector('.empty-state');
            if (emptyState) emptyState.remove();

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.textContent = content;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>

</html>