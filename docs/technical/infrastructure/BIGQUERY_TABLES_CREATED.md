# BigQuery Tables Created for Services

**Created**: 2026-01-06
**Purpose**: Parallel BigQuery structures for High and Medium priority services

---

## Summary

Successfully created **17 BigQuery tables** across **5 datasets** for High and Medium priority services, matching their local DuckDB/JSONL structures.

### Results

- **Total Tables Created**: 17
- **Datasets Created**: 2 (analytics, recommendations)
- **Services with BigQuery**: 12 (up from 3)
- **Services without BigQuery**: 15 (down from 24)

---

## Tables Created

### High Priority Services

#### 1. Cost Service → `governance.costs`
- **Purpose**: Track and manage all costs
- **Schema**: 10 fields including cost_id, service, operation, cost_usd, provider, metadata, timestamps
- **Status**: ✅ Created

#### 2. Run Service → `governance.runs`
- **Purpose**: Track and manage all execution runs
- **Schema**: 17 fields including run_id, run_type, component, operation, status, timing, correlation_id, trace_id, results, metrics
- **Status**: ✅ Created

#### 3. Truth Service → `knowledge.atoms`
- **Purpose**: Store knowledge atoms extracted from conversations
- **Schema**: 14 fields including atom_id, content, atom_type, confidence, source tracking, entities, context
- **Status**: ✅ Created

#### 4. Knowledge Graph Service → `knowledge.nodes`, `knowledge.edges`
- **Purpose**: Store knowledge graph nodes and relationships
- **Schema**:
  - **nodes**: 10 fields including node_id, label, entity_type, aliases, source tracking
  - **edges**: 15 fields including edge_id, subject/object, predicate, status, confidence, contradiction tracking
- **Status**: ✅ Created

#### 5. Analytics Service → `analytics.results`
- **Purpose**: Store analytics results and insights
- **Schema**: 11 fields including analytics_id, analysis_type, query, results, execution metrics
- **Status**: ✅ Created

#### 6. Quality Service → `governance.quality`
- **Purpose**: Store quality assessment records
- **Schema**: 19 fields including quality_id, entity tracking, quality scores (overall, completeness, correctness, consistency, timeliness), issues, recommendations
- **Status**: ✅ Created

#### 7. Testing Service → `governance.test_results`
- **Purpose**: Store test results from script testing
- **Schema**: 11 fields including test_id, script_path, framework_validation, test_results, overall_status
- **Status**: ✅ Created

### Medium Priority Services

#### 8. Relationship Service → `spine.relationships`
- **Purpose**: Store relationships between entities
- **Schema**: 15 fields including relationship_id, source/target entities, relationship_type, direction, strength, confidence
- **Status**: ✅ Created

#### 9. Version Service → `governance.versions`
- **Purpose**: Track versions of entities, documents, code, and artifacts
- **Schema**: 16 fields including version_id, entity_id, version_number, content, changes, parent/child version tracking
- **Status**: ✅ Created

#### 10. Workflow Service → `governance.workflows`
- **Purpose**: Store workflow execution records
- **Schema**: 18 fields including workflow_id, workflow_name, steps, status, step tracking, results, timing
- **Status**: ✅ Created

#### 11. Verification Service → `governance.verifications`
- **Purpose**: Store verification records
- **Schema**: 12 fields including verification_id, entity tracking, verification_type, expected/actual values, differences
- **Status**: ✅ Created

#### 12. Script Service → `governance.scripts`
- **Purpose**: Store script metadata
- **Schema**: 8 fields including script_id, script_path, script_name, script_type, frontmatter
- **Status**: ✅ Created

#### 13. Recommendation Service → `recommendations.recommendations`
- **Purpose**: Store recommendations generated by LLM
- **Schema**: 10 fields including recommendation_id, entity tracking, recommendation_type, content, priority, confidence
- **Status**: ✅ Created

#### 14. Sentiment Service → `analytics.sentiment`
- **Purpose**: Store sentiment analysis results
- **Schema**: 8 fields including sentiment_id, entity tracking, sentiment_label, sentiment_score, emotions
- **Status**: ✅ Created

#### 15. Model Gateway Service → `governance.model_requests`, `governance.model_responses`
- **Purpose**: Store LLM requests and responses
- **Schema**:
  - **model_requests**: 15 fields including request_id, prompt, provider, model_name, parameters, template info
  - **model_responses**: 14 fields including response_id, request_id, text, provider, tokens, cost, parsed output
- **Status**: ✅ Created

---

## Datasets Created

1. **analytics** - For analytics and sentiment data
2. **recommendations** - For recommendation data

### Existing Datasets Used

- **governance** - For governance-related data (costs, runs, quality, versions, workflows, verifications, scripts, test_results, model_requests, model_responses)
- **knowledge** - For knowledge data (atoms, nodes, edges)
- **spine** - For spine/relationship data (relationships)

---

## Services Still Without BigQuery

The following services do not have BigQuery structures (15 total):

### Low Priority (May Not Need BigQuery)

1. **Search Service** - Local search may be sufficient
2. **Builder Service** - Build metadata may be local-only
3. **Schema Service** - In-memory registry may be sufficient
4. **Extractor Service** - Delegates to other services
5. **DuckDB Flush Service** - Flushes to knowledge atoms (which have BQ)
6. **Frontmatter Service** - May not need cloud storage
7. **Analysis Service** - May aggregate from other services
8. **Reality Extractor Service** - May not need separate BQ structure
9. **Embedding Service (Canonical)** - May store embeddings differently
10. **BigQuery Archive Service** - Writes to archive dataset (needs verification)

### Services That May Need BigQuery Later

1. **Frontmatter Service** - If frontmatter tracking becomes important
2. **Analysis Service** - If analysis results need cloud storage
3. **Reality Extractor Service** - If reality extractions need cloud storage
4. **Embedding Service** - If embeddings need cloud storage

---

## Schema Alignment

All BigQuery tables are designed to match the local service models:

- **Field names** match model attribute names
- **Data types** are converted appropriately (e.g., Decimal → NUMERIC, datetime → TIMESTAMP, Dict → JSON, List → REPEATED)
- **Required fields** match model required fields
- **Nullable fields** match model optional fields
- **JSON fields** preserve complex nested structures
- **REPEATED fields** handle list/array data

---

## Usage

### Create Tables

```bash
# Dry run (see what would be created)
python3 scripts/migration/create_service_bigquery_tables.py --dry-run

# Create all tables
python3 scripts/migration/create_service_bigquery_tables.py

# Create specific tables
python3 scripts/migration/create_service_bigquery_tables.py --tables governance.costs governance.runs
```

### Verify Tables

```bash
# Check all services for BigQuery structures
python3 scripts/validation/check_service_bigquery_structures.py
```

---

## Next Steps

1. **Update Services**: Modify services to sync data to BigQuery tables
2. **Data Migration**: Migrate existing local data to BigQuery (if needed)
3. **Monitoring**: Set up monitoring for BigQuery table usage
4. **Documentation**: Document BigQuery table usage in service READMEs

---

## Files Created

1. **`scripts/migration/create_service_bigquery_tables.py`** - Script to create all BigQuery tables
2. **`docs/BIGQUERY_TABLES_CREATED.md`** - This documentation file
3. **`docs/SERVICES_MISSING_BIGQUERY_STRUCTURES.md`** - Updated with new status

---

**This document is automatically generated and maintained by the service BigQuery structure check system.**
